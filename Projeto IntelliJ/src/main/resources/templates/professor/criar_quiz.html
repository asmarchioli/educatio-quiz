<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <!-- <link rel="stylesheet" th:href="@{/css/home_style.css}"> -->
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/fluxo_professor.css}">-->
    <title>Educatio Quiz - Criar Novo Quiz</title>
</head>
    <body>

        <nav class="navbar">
            <h1>üéì Educatio Quiz - Professor</h1>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <span th:text="${professor.nome}"></span>
                <a href="/logout" class="btn-logout">Sair</a>
            </div>
        </nav>

        <!-- CONTE√öDO PRINCIPAL: Formul√°rio de Cria√ß√£o de Quiz -->
        <main class="main-content" style="max-width: 800px; margin: 4rem auto;">
            <div class="content-card" style="padding: 3rem;">

                <h2 class="text-center font-bold mb-10" style="color: var(--text-light); font-size: 2rem;">
                    Cria√ß√£o de Novo Quiz
                </h2>

                <!-- Simulando a A√ß√£o de Envio para o Backend (URL de salvamento) -->
                <form id="create-quiz-form" 
                      th:action="${quiz.id_quiz == null} 
                           ? @{/quiz/salvar} 
                           : @{/quiz/atualizar}" 
                    method="post" 
                    th:object="${quiz}">


                    <!-- CAMPO OCULTO: ID da Quest√£o (Necess√°rio para o id_quiz e a data de cria√ß√£o recebidos do backend serem os mesmos do objeto atualizado) -->
                    
                    <input type="hidden" th:field="*{id_quiz}" th:value="${quiz.id_quiz}"/>
                    <input type="hidden" th:field="*{data_criacao}" th:value="${quiz.data_criacao}" />
                    
                    <!-- CAMPO OCULTO: Professor Criador (Injetado pelo Backend) -->
                    <input type="hidden" th:field="*{professor_criador}" th:value="${professor.getId_professor()}" />
                    

                    <!-- T√≠tulo do Quiz (titulo) -->
                    <div class="form-group">
                        <label for="quiz-title" class="form-label">
                            T√≠tulo do Quiz (M√°x. 255 caracteres)
                        </label>
                        <input type="text" id="quiz-title" th:field="*{titulo}" required
                               class="form-input"
                               maxlength="255"
                               placeholder="Ex: Revis√£o de Hist√≥ria - Cap√≠tulo 5"
                        >
                    </div>

                    <!-- Visibilidade (visibilidade: Exibicao) -->
                    <div class="form-group">
                        <label for="quiz-visibility" class="form-label">
                            Visibilidade do Quiz (P√∫blica ou Privada - Requer PIN)
                        </label>
                        <select id="quiz-visibility" th:field="*{visibilidade}" required class="form-input" onchange="togglePinAccess()">
                            <option value="" disabled selected>Defina a visibilidade </option>
                            <option th:each= "exibicao : ${exibicoes}" th:value="${exibicao}" th:text="${exibicao}"> </option>
                            <!-- Valores simulando Enum Exibicao -->
                            <!-- <option value="PUBLICO">P√∫blico (N√£o requer PIN)</option>
                            <option value="PRIVADO">Privado (Requer PIN de Acesso)</option> -->
                        </select>
                    </div>

                    <!-- PIN de Acesso (pin_acesso) - Inicialmente Oculto se Visibilidade for P√∫blica -->
                    <div class="form-group" id="pin-access-group" style="display: none;">
                        <label for="quiz-pin" class="form-label">
                            PIN de Acesso (Obrigat√≥rio para acesso Privado)
                        </label>
                        <input type="text" id="quiz-pin" th:field="*{pin_acesso}"
                               class="form-input"
                               maxlength="50"
                               placeholder="Ex: H9A2B"
                        >
                    </div>

                    <!-- N√≠vel Educacional (nivel_educacional: Escolaridade) -->
                    <div class="form-group">
                        <label for="quiz-level" class="form-label">
                            N√≠vel Educacional
                        </label>
                        <select id="quiz-level" th:field="*{nivel_educacional}" required class="form-input">
                            <option value="" disabled selected>Selecione o n√≠vel</option>
                            <option th:each= "nivel : ${escolaridades}" th:value="${nivel}" th:text="${nivel}"> </option>
                            <!-- Valores simulando Enum Escolaridade -->
                            <!-- <option value="Fundamental I">Fundamental I</option>
                            <option value="Fundamental II">Fundamental II</option>
                            <option value="Ensino M√©dio">Ensino M√©dio</option>
                            <option value="Gradua√ß√£o">Gradua√ß√£o</option>
                            <option value="P√≥s-Gradua√ß√£o">P√≥s-Gradua√ß√£o</option> -->
                        </select>
                    </div>

            
                    <!-- AREAS DO PROF -->
                    <div class="form-group">
                        <label for="area" class="form-label">√Årea</label>
                        <select id="area" th:field="*{area}" required class="form-input">
                             <option th:each= " area:${areas}" th:value="${area.getIdArea()}" th:text="${area.getNomeArea()}"> </option>
                        </select>
                    </div>

                    <!-- Descri√ß√£o (descricao) -->
                    <div class="form-group" style="margin-bottom: 2rem;">
                        <label for="quiz-description" class="form-label">
                            Descri√ß√£o (Opcional)
                        </label>
                        <textarea id="quiz-description" th:field="*{descricao}" rows="3"
                                  class="form-input"
                                  placeholder="Breve descri√ß√£o sobre o prop√≥sito do quiz."
                        ></textarea>
                    </div>

                    <!-- Bot√£o de A√ß√£o -->
                    <div class="flex justify-end space-x-4">

                        <!-- Bot√£o de Voltar/Cancelar (Simulando link de Voltar) -->
                        <a href="/professor/home"
                            class="btn btn-secondary font-bold" style="font-size: 1.1rem; 
                            padding: 1rem 2rem;
                            margin-right: 1rem">
                            Cancelar
                        </a>
                        

                        <!-- Bot√£o de Envio (Simulando o POST) -->
                        <button type="submit" class="btn btn-primary font-bold" style="font-size: 1.1rem; padding: 1rem 2rem;">
                            Salvar e Adicionar Quest√µes
                        </button>
                    </div>
                </form>
            </div>
        </main>

        <!-- Rodap√© opcional -->
        <footer class="main-content" style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 1rem;">
            &copy; 2024 Educatio Quiz. Todos os direitos reservados.
        </footer>
        
        <!-- L√≥gica JavaScript M√≠nima para Controle de Visibilidade do PIN -->
        <script>
            document.addEventListener('DOMContentLoaded', (event) => {
                // Inicializa a visibilidade do PIN no carregamento da p√°gina
                togglePinAccess();
            });

            function togglePinAccess() {
                const visibilitySelect = document.getElementById('quiz-visibility');
                const pinGroup = document.getElementById('pin-access-group');
                const pinInput = document.getElementById('quiz-pin');

                // Verifica o valor selecionado (PRIVADO ou PUBLICO)
                const isPrivate = visibilitySelect.value === 'Privado';

                if (isPrivate) {
                    // Se for PRIVADO, exibe o campo e torna obrigat√≥rio para valida√ß√£o do backend
                    pinGroup.style.display = 'block';
                    pinInput.required = true;
                    pinInput.setAttribute('th:required', 'required'); // Ajuda na integra√ß√£o Thymeleaf/Spring
                } else {
                    // Se for PUBLICO, oculta o campo e remove a obrigatoriedade
                    pinGroup.style.display = 'none';
                    pinInput.required = false;
                    pinInput.removeAttribute('th:required');
                    pinInput.value = null; 
                }
            }
        </script>
    </body>
</html>