<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educatio Quiz - Meus Quizzes</title>
    
    <link rel="stylesheet" th:href="@{/css/fluxo_professor.css}">
    <link rel="stylesheet" th:href="@{/css/global.css}">
</head>
<body>

    <nav class="navbar">
        <h1>üéì Educatio Quiz - Professor</h1>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span th:text="${professor.nome}"></span>
            <a href="/logout" class="btn-logout">Sair</a>
        </div>
    </nav>

    <!-- Mensagens de sucesso e erro -->
    <div th:if="${success}" class="alert alert-success" 
         style="background-color: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #c3e6cb;">
        <span th:text="${success}"></span>

        <button type="button" 
                onclick="this.parentElement.style.display='none'"
                style="background: none; border: none; color: #721c24; font-size: 1.2rem; font-weight: bold; cursor: pointer;">
            &times;
        </button>
    </div>

    <div th:if="${error}" class="alert alert-danger" 
         style="background-color: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #f5c6cb;">
        <span th:text="${error}"></span>

        <button type="button" 
                onclick="this.parentElement.style.display='none'"
                style="background: none; border: none; color: #721c24; font-size: 1.2rem; font-weight: bold; cursor: pointer;">
            &times;
        </button>
    </div>


    

    <!-- Cards de Quizzes -->
    <main class="main-content">
        <div class="content-card">

            <h1 class="text-center font-semibold mb-8" style="color: var(--text-light); font-size: 1.5rem;">
                Meus Quizzes
            </h1>
            
            <a href="/professor/home" 
                class="btn btn-secondary font-bold" style="font-size: 1.1rem; 
                padding: 1rem 2rem;">
                 ‚¨ÖÔ∏è Voltar para Menu Inicial
            </a>
            
            <div class="flex justify-end gap-4 mb-8">
                <a href="/quiz/criar" class="btn btn-primary font-semibold">
                    ‚ûï Criar Novo Quiz
                </a>
            </div>

            <!-- Grid de Cards -->
            <div class="cards">

                <div th:each="quiz : ${quizzes}" class="quiz-card">
                    <div>
                        <!-- T√≠tulo do Quiz -->
                        <h2 th:text="${quiz.titulo}" class="card-title"></h2>

                        <div class="card-details space-y-1">
                            <strong class="text-muted">√Årea:</strong>
                            <p th:text="${quiz.nome_area}"></p>
                        </div>

                        <div class="card-details space-y-1">
                            <strong class="text-muted">N√≠vel:</strong>
                            <p th:text="${quiz.nivel_educacional}"></p>
                        </div>

                        <div class="card-details space-y-1">
                            <strong class="text-muted">Visibilidade:</strong>

                            <p>
                                <span th:text="${quiz.visibilidade}"></span>

                                <span th:if="${quiz.visibilidade.name() == 'PRIVADO'}" 
                                      class="text-accent" 
                                      style="font-size: 0.9em; margin-left: 5px;">

                                      (<span th:text="${quiz.pin_acesso}"></span>)
                                </span>
                            </p>
                        </div>

                        <div class="card-details space-y-1">
                            <strong class="text-muted">N¬∞ Quest√µes:</strong>
                            <p th:text="${quiz.num_questoes}"></p>
                        </div>
                        
                        <div class="card-details space-y-1">
                            <strong class="text-muted">N¬∞ de Vezes Respondido:</strong>
                            <p th:text="${quiz.qtd_resolucoes}"></p>
                        </div>
                    

                    </div>

                    <div class="flex space-x-2 w-full mt-4">
                        <!-- Bot√£o de Edi√ß√£o -->
                        <a th:href="@{/quiz/relatorios(id_quiz=${quiz.id_quiz})}" class="btn btn-secondary w-1/2 text-center">
                            Relat√≥rios
                        </a>
                        
                        <a th:href="@{/quiz/editar/questoes(id_quiz=${quiz.id_quiz})}" 
                            class="btn btn-primary text-center">
                            Editar 
                        </a>

                        <form th:action="@{/quiz/excluir/{id}(id=${quiz.id_quiz})}" method="post">
                            <button type="button" 
                                    class="btn btn-danger ms-auto"
                                    data-bs-toggle="modal" 
                                    data-bs-target="#modalExclusao"
                                    th:data-id="${quiz.id_quiz}">
                                Excluir
                            </button>
                        </form>

                    </div>
                </div>


                 <div th:if="${#lists.isEmpty(quizzes)}" class="w-full text-center p-8 text-muted">
                    <p>Voc√™ ainda n√£o criou nenhum Quiz. Comece criando um novo!</p>
                </div>
            </div>
            <!-- Fim do Grid -->

        </div>
    </main>

    <div class="modal fade" data-bs-theme="dark" id="modalExclusao" tabindex="-1" aria-labelledby="modalExclusaoLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5 text-danger" id="modalExclusaoLabel">Confirmar Exclus√£o</h1>
                </div>
                <div class="modal-body text-accent"> Tem certeza que deseja excluir este quiz? <br><br>
                    <span style="color: var(--danger);"> Esta a√ß√£o: </span><br>
                    <span style="color: var(--danger-light);"> - Excluir√° o quiz do hist√≥rico dos alunos que o realizaram </span>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

                    <form th:action="@{/quiz/excluir}" method="post">
                        <input type="hidden" name="id_quiz" id="idQuizInputHidden" value="" />
                        <button type="submit" class="btn btn-danger">Sim, Excluir</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modalExclusao = document.getElementById('modalExclusao');
            if (modalExclusao) {
                modalExclusao.addEventListener('show.bs.modal', event => {
                    // Bot√£o que acionou o modal
                    const button = event.relatedTarget;
                    // Extrai o ID do atributo data-id
                    const idQuiz = button.getAttribute('data-id');
                    // Atualiza o input oculto no formul√°rio do modal
                    const hiddenInput = modalExclusao.querySelector('#idQuizInputHidden');
                    hiddenInput.value = idQuiz;
                });
            }
        });
    </script>
</body>
</html>