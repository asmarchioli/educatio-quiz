<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educatio Quiz - Editar Quiz</title>
    <!-- <link rel="stylesheet" th:href="@{/css/quiz_style.css}"> -->
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/fluxo_professor.css}">
</head>
<body>

    <nav class="navbar">
        <h1>üéì Educatio Quiz - Professor</h1>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span th:text="${professor.nome}"></span>
            <a href="/logout" class="btn-logout">Sair</a>
        </div>
    </nav>

    
    <!-- CONTE√öDO PRINCIPAL: Edi√ß√£o de Quest√µes do Quiz -->
     <main class="main-content">
        <div class="content-card">

            <!-- BLOCO 1: T√≠tulo do Quiz e Bot√µes Principais -->
            <!-- Usa a nova classe quiz-header para controle de flexbox e espa√ßamento -->
            <div class="quiz-header">
                <!-- T√≠tulo do Quiz (Ocupa o espa√ßo restante) -->
                <h2 class="text-xl font-semibold" style="color: var(--text-light);">
                    Quiz: <span th:text="${quiz.titulo}" class="text-accent"></span>
                </h2>

                <!-- Container dos bot√µes principais (Adicionar e Voltar) -->
                <div class="quiz-actions-group">
                    <!-- Bot√£o de Cria√ß√£o -->
                    <a th:href="@{/quiz/banco_questoes(quizId=${quiz.id_quiz})}" class="btn btn-primary">
                        ‚ûï Adicionar quest√£o
                    </a> 

                    
                    <a th:href="@{/quiz/modificar/{id_quiz}(id_quiz = ${quiz.id_quiz})}" class="btn btn-secondary">
                        Editar informa√ß√µes do quiz
                    </a>    
                        
                    <!-- Bot√£o de Voltar/Cancelar -->
                    <a href="/professor/home"         
                        class="btn btn-secondary ">
                        ‚¨ÖÔ∏è Voltar para Menu Inicial
                    </a>
                </div>
            </div>

            <!-- BLOCO 2: BARRA DE PESQUISA DIN√ÇMICA -->
            <!-- Usa a nova classe filter-bar para controle de flexbox e espa√ßamento -->
            <div class="filter-bar">
                <!-- Dropdown de Tipo de Busca -->
                <select id="search-type" class="form-select search-filter-select" onchange="filterQuestions()">
                    <option value="enunciado">Buscar por Enunciado</option>
                    <option value="tipo">Buscar por Tipo da Quest√£o</option>
                </select>

                <!-- Input de Pesquisa - Usa search-container para ocupar o resto da largura -->
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Digite para buscar..."
                           class="form-input search-input"
                           onkeyup="filterQuestions()"
                    >
                    <div class="search-icon">
                        <!-- √çcone de Lupa - SVG mantido, mas o posicionamento √© feito pelo CSS:search-container -->
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            
            <!-- Tabela Responsiva de Quest√µes -->
           <div class="table-container"> 
                <table class="dark-table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">N¬∞Quest√£o</th>
                            <th style="width: 15%;">Tipo</th>
                            <th style="width: 40%;">Enunciado</th>
                            <th style="width: 15%;">N√≠vel</th>
                            <th class="text-center" style="width: 10%;">Dificuldade</th>
                            <th class="text-center" style="width: 15%;">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="questao, stat : ${questoes}">

                            <td th:text="${stat.count}">N√∫mero da Quest√£o</td>
                            <td th:text="${questao.tipo_questao}"></td>
                            <td th:text="${questao.enunciado}"
                                style="max-width: 350px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            </td>
                            <td th:text="${questao.nivel_educacional}" class="text-center"></td>
                            <td th:text="${questao.nivel_dificuldade}" class="text-center text-accent" ></td>
                            
                            <!-- alguma dessas classes deve estar quebrando a tabela -->
                            <td class="flex items-center space-y-1">
                                <div class="flex-column-buttons">
                                    <a th:href="@{/questao/buscar/{id}(id=${questao.id_questao}, quizid=${quiz.id_quiz})}" 
                                       class="table-action-btn btn-details" 
                                       data-toggle="page">
                                        Detalhes
                                    </a>

                                    <form th:action="@{/quiz/excluir/questao}" method="post" class="inline-block">
                                        <input type="hidden" name="id_questao" th:value="${questao.id_questao}" />
                                        <input type="hidden" name="id_quiz" th:value="${quiz.id_quiz}" />
                                        <button type="submit" class="table-action-btn btn-danger-table"> 
                                              Excluir
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Linha de Mensagem de Quiz Vazio (th:if garante que s√≥ aparece se a lista de quest√µes estiver vazia) -->
                        <tr id="empty-quiz-row" th:if="${#lists.isEmpty(questoes)}">
                            <td colspan="6" class="text-center" style="color: var(--text-muted); padding: 2rem;">
                                Nenhuma quest√£o adicionada a este quiz. Use o bot√£o acima para adicionar!
                            </td>
                        </tr>

                        <!-- Linha de Mensagem de Filtro Vazio (Controlada pelo JS) -->
                        <tr id="no-results-row" style="display: none;">
                            <td colspan="6" class="text-center" style="color: var(--text-muted); padding: 2rem;">
                                Nenhuma quest√£o encontrada com este filtro.
                            </td>
                        </tr>
                    </tbody>
                </table>

                    
            </div> 
            <!-- Fim da Tabela -->

        </div>
    </main> 

    <!-- Rodap√© opcional -->
    <footer class="main-content" style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 1rem;">
        &copy; 2024 Educatio Quiz. Todos os direitos reservados.
    </footer> 

    <script>
        /**
         * Inicializa a p√°gina adicionando o listener de evento de mudan√ßa ao dropdown.
         */
        function initializePage() {
            // Adiciona listener para o dropdown de tipo de pesquisa
            const searchType = document.getElementById('search-type');
            if (searchType) {
                searchType.addEventListener('change', filterQuestions);
            }
        }

        /**
         * Realiza a filtragem das quest√µes na tabela com base no texto e no tipo de busca selecionado.
         */
        function filterQuestions() {
            const input = document.getElementById('search-input');
            // Obt√©m o texto do filtro em mai√∫sculas e remove espa√ßos em branco extras
            const filter = input.value.toUpperCase().trim(); 
            const type = document.getElementById('search-type').value; // 'enunciado' ou 'tipo'
            const rows = document.querySelectorAll('.question-row');
            const emptyQuizRow = document.getElementById('empty-quiz-row');
            const noResultsRow = document.getElementById('no-results-row');
            let visibleRows = 0;

            // Oculta a mensagem de quiz vazio (se ela existir) ao iniciar a filtragem
            if (emptyQuizRow) {
                emptyQuizRow.style.display = 'none'; 
            }

            // Caso o filtro esteja vazio, exibe todas as quest√µes e gerencia as mensagens de status
            if (filter.length === 0) {
                rows.forEach(row => {
                    row.style.display = ""; // Mostra a linha
                    visibleRows++;
                });

                // Reexibe a mensagem de quiz vazio apenas se ela foi carregada pelo Thymeleaf (ou seja, lista original estava vazia)
                if (emptyQuizRow) {
                    emptyQuizRow.style.display = ''; 
                }

                noResultsRow.style.display = 'none'; // Oculta a mensagem de nenhum resultado do filtro
                return;
            }

            // Aplica o filtro
            rows.forEach(row => {
                let cell;

                // Seleciona a c√©lula de busca correta com base no tipo
                if (type === 'enunciado') {
                    cell = row.querySelector('[data-filter-enunciado]');
                } else {
                    cell = row.querySelector('[data-filter-type]');
                }

                if (cell) {
                    const cellValue = cell.textContent || cell.innerText;
                    // Verifica se o valor da c√©lula cont√©m o texto do filtro
                    if (cellValue.toUpperCase().indexOf(filter) > -1) {
                        row.style.display = ""; // Mostra a linha
                        visibleRows++;
                    } else {
                        row.style.display = "none"; // Oculta a linha
                    }
                } else {
                    // Oculta a linha se, por algum motivo, a c√©lula de filtro n√£o for encontrada
                    row.style.display = "none"; 
                }
            });

            // Gerencia a mensagem de "Nenhuma quest√£o encontrada com este filtro"
            noResultsRow.style.display = visibleRows === 0 ? '' : 'none';
        }

        window.onload = initializePage;
    </script>
</body>
</html>